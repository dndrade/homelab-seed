version: '3'

includes:
  terraform:
    taskfile: terraform/Taskfile.yml
    dir: .
  ansible:
    taskfile: ansible/Taskfile.yml

env:
  REPO_ROOT: "{{.PWD}}"

tasks:
  deploy:
    desc: Full infra + config deployment
    cmds:
      - echo "ğŸš€ Starting deployment"
      - task terraform:apply
      - task ansible:deploy
      - echo "âœ… Deployment complete"

  check:
    desc: Safe dry-run
    cmds:
      - echo "ğŸ” Dry run"
      - task terraform:plan
      - task ansible:check

  # rotate:
  #   desc: Rotate all infrastructure secrets
  #   cmds:
  #     - echo "ğŸ”„ Rotating secrets"
  #     - task ansible:rotate-secrets
  #     - echo "âœ… Secret rotation complete"


  # rotate-:check:
  #   desc: Dry-run secret rotation
  #   cmds:
  #     - echo "ğŸ” Secret rotation dry-run"
  #     - task ansible:rotate-secrets:check

  destroy:
    desc: Tear everything down
    cmds:
      - echo "âš ï¸ Destroying infrastructure"
      - task terraform:destroy
      - echo "ğŸ’¥ Infrastructure destroyed"
